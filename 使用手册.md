# MiniSys 汇编/编译器使用手册

## 目录

1. [系统简介](#系统简介)
2. [环境准备与安装](#环境准备与安装)
3. [快速开始](#快速开始)
4. [SEUYacc 工具使用](#seuyacc-工具使用)
5. [Mini-C 编译器使用](#mini-c-编译器使用)
6. [完整工作流程](#完整工作流程)
7. [附录](#附录)

---

## 系统简介

本系统包含 **SEUYacc** 和 **SEULex** 两个配套工具：

- **SEUYacc**：LR(1) 语法分析器生成器，读取 .y 文件生成 C 解析器代码，支持语义动作和 JSON 错误诊断
- **SEULex**：词法分析器生成器，读取 .l 文件生成词法分析代码（由团队其他成员维护）

基于这两个工具实现了 **Mini-C 编译器**，可将 C 语言子集编译为 RISC-V 32I 汇编代码。

---

## 环境准备与安装

### 系统要求

- C++17 编译器（GCC 7+ / Clang 5+）
- xmake 构建工具
- SEULex 工具（配套使用）

### SEULex 安装与配置

**【此部分由 SEULex 团队成员补充】**

<!-- 请在此处添加 SEULex 的安装、构建和配置说明 -->

### SEUYacc 构建

```bash
cd seuyacc
xmake

# 可执行文件位于 build/ 目录
# 可选：添加到 PATH
sudo ln -s $(pwd)/build/macosx/arm64/release/seuyacc /usr/local/bin/seuyacc
```

---

## 快速开始

### 使用示例脚本

```bash
./run_examples.sh              # 运行所有示例
./run_examples.sh fibonacci    # 运行特定示例
```

### 手动编译流程

```bash
# 1. 生成解析器
./seuyacc examples/minic.y

# 2. 生成词法分析器（SEULex）
./seulex examples/minic.l

# 3. 编译并链接
gcc -I. minic.tab.c minic_lex.yy.c -o minic_parser

# 4. 编译 C 源文件
./minic_parser < examples/fibonacci.c

# 5. 查看生成的汇编
cat output.asm
```

---

## SEUYacc 工具使用

### 命令行选项

```bash
seuyacc [选项] <yacc文件>
```

| 选项 | 说明 |
|-----|------|
| `-d, --definitions` | 生成头文件（.tab.h） |
| `-p, --plantUML` | 生成状态图（.puml） |
| `-m, --markdown` | 生成分析表（.md） |

### 使用示例

```bash
# 基本用法
./seuyacc examples/minic.y

# 生成头文件和可视化
./seuyacc -d -p -m examples/minic.y
```

### 语法文件结构

语法文件分为三个部分（用 `%%` 分隔）：

```yacc
%{
/* 声明部分：C 代码 */
%}

%token TOKEN_NAME
%type <type> nonterminal
%left '+' '-'

%%
/* 语法规则 */
rule : symbol { $$ = $1; };

%%
/* 用户代码 */
```

语义动作中使用 `$$`（左部）和 `$1, $2...`（右部符号）。

---

## Mini-C 编译器使用

### 支持的语言特性

- **数据类型**：`int`, `void`
- **变量与数组**：`int x;`, `int arr[10];`
- **函数定义**：支持参数和返回值
- **运算符**：算术（`+,-,*,/,%`）、比较（`==,!=,<,>,<=,>=`）、逻辑（`&&,||,!`）、位运算（`&,|,^,~,<<,>>`）
- **控制流**：`if-else`, `while`, `return`
- **数组与函数调用**

### 示例程序

详细示例见 `examples/` 目录：

- `fibonacci.c` - 递归计算 Fibonacci 数列
- `array_access.c` - 数组操作
- `array_param.c` - 数组参数传递
- `led_control.c` - LED 控制（位运算）

### 错误诊断

语法错误时生成 JSON 格式诊断报告，包含行号、错误类型和期望符号。

---

## 完整工作流程

```bash
# 1. 编写 C 源代码（例如 my_program.c）

# 2. 生成解析器
./seuyacc --definitions examples/minic.y
./seulex examples/minic.l

# 3. 编译解析器
gcc -I. minic.tab.c minic_lex.yy.c -o minic_parser

# 4. 编译 C 程序
./minic_parser < my_program.c

# 5. 查看生成的汇编
cat output.asm
```

---

## 附录

### 附录 A：SEUYacc 语法文件模板

```yacc
%{
#include <stdio.h>
%}

%token IDENT NUMBER
%type <node> expr

%%
program : expr { $$ = $1; };
expr : NUMBER { $$ = $1; };
%%

int main() { return yyparse(); }
```

### 附录 B：SEULex 相关

**【此部分由 SEULex 团队成员补充】**

<!-- 请在此处添加 SEULex 语法文件模板、使用示例等 -->

---

更多示例和详细信息请参考项目 `examples/` 目录。
